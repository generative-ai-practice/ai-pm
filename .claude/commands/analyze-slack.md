---
description: Slackログを分析しIssue化すべきトピックを抽出・起票する
argument-hint: YYYY-MM-DD
disable-model-invocation: true
---

# Slack分析 → Issue起票コマンド

Slackログを分析し、Issue化すべきトピックを抽出して、既存Issue/PRの有無を確認し、未起票のものは起票する。

引数: `$ARGUMENTS` に開始日（例: `2026-01-31`）が渡される。引数がない場合は7日前を開始日とする。
開始日から今日までの期間を分析対象とする。

---

## Step 1: データ更新 & Slackログ読み込み

1. 引数 `$ARGUMENTS` から開始日（YYYY-MM-DD形式）を取得する。空の場合は7日前の日付を使う。
2. 開始日から今日までにまたがる月を特定する（例: 開始日が `2026-01-31` で今日が `2026-02-07` なら `2026-01` と `2026-02`）。
3. Slackキャッシュを最新化する:
   ```bash
   cd /Users/yasutaka/Documents/mac-workspace/ai-pm && yarn slack:update
   ```
4. 対象の各月についてMarkdownを生成/更新する:
   ```bash
   cd /Users/yasutaka/Documents/mac-workspace/ai-pm && yarn slack:export-md {YYYY-MM}
   ```
   （対象月が複数あれば、それぞれ実行する）
5. 各 `output/slack-{YYYY-MM}.md` を読み込む。
6. **開始日より前のメッセージは除外する**（タイムスタンプ `[YYYY-MM-DDTHH:mm:ss.sssZ]` で判定）。

---

## Step 2: Slackログ分析 → Issue候補抽出

読み込んだSlackログを分析し、**Issue化すべきトピック**を抽出する。

### 抽出対象
- タスク依頼（「〜してください」「〜をお願いします」）
- バグ報告（「エラーになる」「動かない」「おかしい」）
- 機能要望（「〜できるようにしたい」「〜が欲しい」）
- TODO・改善提案（「〜した方がいい」「〜を検討」）
- ドキュメント化の依頼

### 除外対象
- 単なるリンク共有（コメントなし）
- 完了報告（「マージしました」「取り込みました」）
- 雑談・挨拶
- 既に完了が確認できるタスク

### 出力
抽出した各トピックについて、以下を簡潔にまとめる:
- トピックの概要（1行）
- 関連するSlackメッセージのタイムスタンプ
- 関連するGitHub URL（Slackメッセージ中にあれば）

---

## Step 3: 既存Issue/PRの確認

1. `config/github-repos.json` を読み込み、監視対象リポジトリ一覧を取得する。

2. 各トピックについて以下を行う:

### リポジトリ推測
Slackメッセージ中の以下の情報から対象リポジトリを推測する。**推測根拠を必ず明示すること。**
- GitHub URL（`github.com/{owner}/{repo}` のパターン）
- プロジェクト名への言及（mulmocast, graphai, grapys 等）
- 技術的なキーワード

### ナレッジ参照
`data/knowledge/{repo名}.md` が存在する場合は読み込み、主要Issue・決定事項・進行中の取り組みと照合する。
ナレッジに記載のある既存Issueに包含されるトピックは「既存Issue/PRあり」として扱う。

### 既存Issue/PR検索
```bash
gh search issues "検索キーワード" --repo {owner}/{repo} --json number,title,url,state
```
- ヒットした場合: `gh issue view {number} --repo {owner}/{repo}` で詳細を取得
- PRの場合: `gh pr view {number} --repo {owner}/{repo}` で詳細を取得

---

## Step 4: 結果出力

以下のフォーマットでMarkdownを出力する:

```
## Slack分析結果（{開始日} 〜 {今日}）

### 1. [{リポジトリ名}] {トピック概要}
- **ステータス**: {既存Issue/PRあり | 未起票}
- **関連**: {既存Issue/PRのURLがあれば記載}
- **推測根拠**: {リポジトリ推測の根拠}
- **対応**: {対応不要 | 起票推奨}
- **Slack要約**:
  > {関連するSlack会話の要約。誰が何を言ったかの文脈がわかるように記述する。}
- **提案タイトル**: {未起票の場合、Issue タイトルを提案}
- **提案本文**:
  > {未起票の場合、Issue 本文を提案。Slack会話の文脈から生成。関連Slackタイムスタンプも含める。}
```

**注意**:
- 「Slack要約」は全てのトピック（対応不要・起票推奨の両方）に記載する
- 「提案タイトル」「提案本文」は未起票（起票推奨）の場合のみ記載する
- 既存Issue/PRがある場合はURL・概要のみ記載する
- 結果は `output/slack-analysis-{開始日}.md` に保存する

---

## Step 5: 未起票Issueの作成

1. 起票推奨のトピック一覧をユーザーに提示する
2. **ユーザーの確認を必ず取ること**（作成する / しない / タイトルや本文を修正する）
3. 承認されたものを以下のコマンドで作成する:
   ```bash
   gh issue create --repo {owner}/{repo} --title "タイトル" --body "本文"
   ```
4. 作成したIssueのURLを報告する

---

## Step 6: ナレッジ更新の提案

全ステップ完了後（Issue作成の有無に関わらず）、以下を行う:
1. `/update-knowledge` を実行するかユーザーに確認する
2. 今回の分析で得られた改善提案があればフィードバックする

---

## 重要なルール

- **ユーザー確認必須**: Issue作成前に必ずユーザーの承認を得ること。勝手に作成しない。
- **推測根拠の明示**: リポジトリの推測は必ず根拠を示すこと。根拠が弱い場合はユーザーに確認する。
- **日本語で出力**: 分析結果、提案タイトル、提案本文はすべて日本語で出力する。
- **重複回避**: 既に存在するIssue/PRと内容が重複する場合は起票しない。
- **ナレッジ参照**: `data/knowledge/` のナレッジファイルが存在する場合は必ず参照し、既存Issueの文脈を把握した上で重複判定を行う。
